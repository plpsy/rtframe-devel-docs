## rtFrame管理PPC节点

### 项目要求及硬件环境：
在jdc项目中，ppc节点选用p2020，使用vx作为操作系统，没有使用rtp模式，p2020虽然是双核，但是使用SMP模式。按照项目需求，p2020可以运行多个中低速程序，或者运行1个高速程序。
 
### PPC代理线程：
在p2020中有一个管理线程，暂命名为rtClient，rtClient与主控节点握手建立连接，代表ppc节点上线，rtClient线程负责搜集上传ppc节点硬件及运行状态；rtClient和应用程序分别为两个out文件，ppc上电后，自动启动。

### PPC被模拟为8个核：
由于PPC节点可能运行多个中低速功能或者高速功能，顾将PPC模拟为8个核，每个核可以运行一个中低速程序或者高速程序，rtClient线程与应用交互时，都会表明现在是在对哪一个核进行加载或者参数注入。rtClient占用1个核，应用使用7个核，当8个核都被占用后，该ppc不能再部署新的应用。

### 高速应用独占PPC：
由于高速应用传输tcp需要独占网络资源，所以需要独占ppc。这里引入内存资源作为第二限制条件，总共有8份内存资源，默认情况被一个核使用1份，当高速应用部署的时候，虽然只使用了1个核，但是需要使用了7份内存资源，这样在部署寻找资源时，可以寻找到未被使用的ppc节点，并且高速部署在该ppc后，由于内存被沾满，可以保证不会有新的中低速或者高速应用再被部署到该节点。

### PPC节点程序加载
高速和中低速功能与rtClient线程同时被启动，但是应用功能一直处于休眠状态，待主控节点下发程序启动命令后，由rtClient调用应用提供的接口开启中低速或者高速功能；待主控节点停止应用后，rtClient通知应用停止功能。

### PPC参数
在主控通知rtClient启动一个应用程序后，用户可以通过参数注入的方式，向应用程序传递一些应用信息，主控与rtClient都不会解析传入的参数。


### PPC中间件链路配置&删除
在jdc项目中，应用之间的链路不再由rio网管进行配置，改为用户自行协商配置。配置链路需要几个要素：
* rio目的id：目标地址由参数注入的方式传入
* rio目的端口号：rio目标端口号是编码人员自行协商+对端核号一起决定（对端核号由参数注入传入）
* rio本地id：本地接口获取
* rio本地端口号：编码人员自行协商+本地端核号一起决定（本地核号应用自己获取）
* 链路缓冲区个数：用户自行协商
* 链路缓冲区大小：用户自行协商，结合缓冲区个数核缓冲区大小（调用本地接口，计算出具体使用的内存地址。）
* 对端节点类型：用户提前协商

作为接收端的用户需要搜集这些信息，搜集好这些信息后，调用链路配置接口，由中间件配置链路。该函数会计算接端实际使用的内存地址，并配置本地及远端发送端的链路。

当应用被解构时，rtClient需要删除中间件的端口描述符、数据描述、申请的数据内存空间。端口描述符、数据描述可以通过核号完全推测，但是
申请的内存空间并非按照核的顺序，所以内存删除函数需要支持按核号删除内存空间。

### PPC中间件使用
编码人员通过核号 + 端口号绑定发送与接收句柄，使用句柄进行通信。

### 配置链路时机
现在用户在启动后，通过等待固定时间，待对端节点rio入网以后，由接收端配置链路。



